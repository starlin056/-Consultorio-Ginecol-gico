RewriteEngine On

# Redirigir HTTP a HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# REGLAS PARA NUEVA CARPETA UPLOADS (fuera de public/)
RewriteRule ^uploads/(.*)$ - [L]

# Reglas existentes para assets
RewriteRule ^assets/(.*)$ public/assets/$1 [L]

# Redirigir todo a index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# PERMITIR ACCESO DIRECTO A UPLOADS
<Location "/uploads">
    Require all granted
    Options -Indexes
</Location>

# Headers de seguridad para imágenes
<FilesMatch "\.(png|jpe?g|gif|svg|webp)$">
    Header always set X-Content-Type-Options "nosniff"
    Header always set Cache-Control "public, max-age=86400"
</FilesMatch>

# Compresión
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/css application/javascript application/json
</IfModule>